<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0E1B14" />
  <title>Panier — MSV Nosy-Be</title>
  <meta name="description"
    content="Votre panier MSV Nosy-Be : ajustez les quantités, appliquez un code promo et finalisez votre commande." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
            display: ['Fraunces', 'ui-serif', 'Georgia', 'serif'],
          },
          colors: {
            obsidian: '#07100C',
            jungle: {
              950: '#06110D',
              900: '#0E1B14',
              800: '#13261C',
              700: '#183023',
            },
            vanilla: {
              50: '#FBF7EF',
              100: '#F6EEDC',
              200: '#EEDDBD',
              300: '#E2CFA7',
            },
            cacao: {
              950: '#120C0A',
              900: '#1A1210',
              800: '#2A1F1A',
              700: '#3C2E27',
              600: '#5A514A',
              500: '#6E625A',
              400: '#8A7E76',
            },
            gold: {
              500: '#D7A84A',
              600: '#C79637',
              700: '#B6842B',
            }
          },
          boxShadow: {
            soft: '0 14px 40px rgba(7,16,12,.16)',
            lift: '0 22px 70px rgba(7,16,12,.22)',
            glow: '0 0 0 1px rgba(215,168,74,.20), 0 18px 60px rgba(215,168,74,.16)',
          },
          borderRadius: { xxl: '1.5rem' }
        }
      }
    }
  </script>

  <!-- Icons -->
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>

  <style>
    .glass-dark {
      background: rgba(246, 238, 220, .06);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(246, 238, 220, .16);
    }

    .card-light {
      background: rgba(255, 255, 255, .72);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(26, 18, 16, .08);
    }

    .focus-ring:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(215, 168, 74, .35);
    }

    .grain::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(rgba(255, 255, 255, .06) 1px, transparent 1px);
      background-size: 3px 3px;
      opacity: .14;
      mix-blend-mode: overlay;
      pointer-events: none;
    }

    .hero {
      background:
        radial-gradient(1200px 420px at 18% 10%, rgba(215, 168, 74, .22), transparent 55%),
        radial-gradient(900px 420px at 80% 20%, rgba(246, 238, 220, .10), transparent 60%),
        linear-gradient(180deg, rgba(14, 27, 20, .96), rgba(14, 27, 20, .86));
    }

    @media (prefers-reduced-motion: reduce) {
      .rm-anim {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>

<body class="bg-vanilla-50 text-cacao-900 font-sans antialiased">
  <a href="#content"
    class="sr-only focus:not-sr-only focus:fixed focus:top-3 focus:left-3 focus:z-[100] focus:bg-white focus:text-cacao-900 focus:px-4 focus:py-2 focus:rounded-full">
    Aller au contenu
  </a>

  <!-- =========================
  HEADER (exotique) — le reste en light
  ========================== -->
  <header class="sticky top-0 z-50 border-b border-vanilla-100/15 bg-jungle-900/70 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-3">
      <a href="index.html" class="flex items-center gap-3 rounded-2xl px-2 py-1 focus-ring">
        <div
          class="w-10 h-10 rounded-2xl bg-vanilla-50/10 border border-vanilla-100/15 grid place-items-center shadow-soft">
          <span class="iconify text-gold-500 text-xl" data-icon="mdi:vanilla"></span>
        </div>
        <div class="leading-tight">
          <p class="font-display text-lg text-vanilla-50">MSV Nosy-Be</p>
          <p class="text-xs text-vanilla-100/70">Panier</p>
        </div>
      </a>

      <nav class="hidden lg:flex items-center gap-1 text-sm text-vanilla-100/85" aria-label="Navigation principale">
        <a class="px-4 py-2 rounded-full hover:bg-vanilla-50/10 focus-ring" href="index.html">Accueil</a>
        <a class="px-4 py-2 rounded-full hover:bg-vanilla-50/10 focus-ring" href="shop.html">Boutique</a>
        <a class="px-4 py-2 rounded-full hover:bg-vanilla-50/10 focus-ring" href="about.html">À propos</a>
        <a class="px-4 py-2 rounded-full hover:bg-vanilla-50/10 focus-ring" href="contact.html">Contact</a>
      </nav>

      <div class="flex items-center gap-2">
        <a href="shop.html"
          class="hidden sm:inline-flex items-center gap-2 rounded-full px-5 py-2.5 text-sm font-semibold text-jungle-900
                 bg-gradient-to-b from-gold-500 to-gold-600 shadow-glow hover:shadow-lift transition rm-anim focus-ring">
          Continuer mes achats
          <span class="iconify" data-icon="mdi:arrow-right"></span>
        </a>
        <span
          class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-xs font-semibold glass-dark text-vanilla-50">
          <span class="iconify text-gold-500" data-icon="mdi:lock-outline"></span>
          Checkout sécurisé <span class="text-vanilla-100/60">(à connecter)</span>
        </span>
      </div>
    </div>
  </header>

  <!-- =========================
  HERO (optionnel, premium + conversion)
  ========================== -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 hero grain" aria-hidden="true"></div>
    <div class="relative mx-auto max-w-7xl px-4 py-10">
      <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full glass-dark px-4 py-2 shadow-soft text-vanilla-50">
            <span class="iconify text-gold-500" data-icon="mdi:check-decagram-outline"></span>
            <span class="text-sm font-semibold">Dernière étape avant le goût.</span>
            <span class="text-sm text-vanilla-100/70">Votre sélection est prête.</span>
          </div>
          <h1 class="mt-4 font-display text-3xl sm:text-4xl text-vanilla-50 leading-[1.06]">
            Votre panier
          </h1>
          <p class="mt-3 text-sm text-vanilla-100/75 max-w-2xl">
            Ajustez les quantités, puis finalisez. <span class="text-vanilla-50 font-semibold">Astuce</span> : un tube
            cadeau + une longueur supérieure = effet “wow” garanti en recette.
          </p>
        </div>

        <!-- Free shipping progress (configurable, sans promesse factuelle) -->
        <div class="rounded-[22px] glass-dark p-4 w-full lg:w-[420px]">
          <div class="flex items-center justify-between gap-3">
            <p class="text-sm font-semibold text-vanilla-50">Objectif panier</p>
            <p id="goalText" class="text-xs text-vanilla-100/70">—</p>
          </div>
          <div class="mt-3 h-2 rounded-full bg-vanilla-50/10 overflow-hidden">
            <div id="goalBar" class="h-full w-0 bg-gradient-to-r from-gold-500 to-gold-600 transition rm-anim"></div>
          </div>
          <p class="mt-2 text-xs text-vanilla-100/60">
            <span class="iconify align-[-2px] text-gold-500" data-icon="mdi:information-outline"></span>
            Paramètre marketing : seuil “livraison offerte” configurable (sinon, ignore ce bloc).
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- =========================
  CART PAGE (LIGHT)
  ========================== -->
  <main id="content" class="mx-auto max-w-7xl px-4 py-10">
    <div class="grid lg:grid-cols-12 gap-8 items-start">
      <!-- Left: items -->
      <section class="lg:col-span-8">
        <div class="flex items-center justify-between gap-4">
          <h2 class="font-display text-2xl">Articles</h2>
          <button id="clearCartBtn"
            class="text-sm font-semibold text-cacao-700 hover:text-cacao-900 underline underline-offset-4 focus-ring rounded-full px-2 py-1">
            Vider le panier
          </button>
        </div>

        <!-- Empty state -->
        <div id="emptyState" class="hidden mt-6 rounded-[28px] card-light shadow-soft p-7">
          <div class="flex flex-col sm:flex-row sm:items-center gap-5">
            <div class="w-14 h-14 rounded-2xl bg-vanilla-100 border border-cacao-900/10 grid place-items-center">
              <span class="iconify text-gold-600 text-3xl" data-icon="mdi:cart-outline"></span>
            </div>
            <div class="flex-1">
              <p class="text-lg font-semibold">Votre panier est vide.</p>
              <p class="mt-1 text-sm text-cacao-700">Choisissez une longueur, un grade, et repartez avec une vanille
                premium.</p>
            </div>
            <a href="shop.html"
              class="inline-flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-semibold text-jungle-900
                     bg-gradient-to-b from-gold-500 to-gold-600 shadow-glow hover:shadow-lift transition rm-anim focus-ring">
              Aller à la boutique
              <span class="iconify" data-icon="mdi:arrow-right"></span>
            </a>
          </div>
        </div>

        <!-- Items list -->
        <div id="itemsList" class="mt-6 space-y-4"></div>

        <!-- Upsell (conversion) -->
        <div class="mt-8 rounded-[28px] card-light shadow-soft overflow-hidden">
          <div class="p-7">
            <p class="text-sm font-semibold text-cacao-900">Petit + qui augmente la satisfaction</p>
            <div class="mt-4 grid sm:grid-cols-2 gap-4">
              <div class="rounded-xxl bg-white/70 border border-cacao-900/10 p-4">
                <div class="flex items-start gap-3">
                  <span class="iconify text-gold-600 text-2xl mt-0.5" data-icon="mdi:gift-outline"></span>
                  <div>
                    <p class="font-semibold">Tube cadeau premium</p>
                    <p class="mt-1 text-sm text-cacao-700">Parfait pour offrir (ou stocker proprement). <span
                        class="text-cacao-500">(à relier à un produit réel)</span></p>
                  </div>
                </div>
              </div>
              <div class="rounded-xxl bg-white/70 border border-cacao-900/10 p-4">
                <div class="flex items-start gap-3">
                  <span class="iconify text-gold-600 text-2xl mt-0.5" data-icon="mdi:chef-hat"></span>
                  <div>
                    <p class="font-semibold">Conseil “chef”</p>
                    <p class="mt-1 text-sm text-cacao-700">1 gousse = 1 crème + sucre vanillé avec la gousse. Zéro
                      perte.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="mt-5 flex flex-col sm:flex-row gap-3">
              <a href="shop.html"
                class="inline-flex items-center justify-center gap-2 rounded-full px-5 py-3 text-sm font-semibold bg-white/80 border border-cacao-900/10 hover:bg-white focus-ring">
                Ajouter un produit
                <span class="iconify" data-icon="mdi:plus"></span>
              </a>
              <a href="about.html"
                class="inline-flex items-center justify-center gap-2 rounded-full px-5 py-3 text-sm font-semibold bg-white/80 border border-cacao-900/10 hover:bg-white focus-ring">
                Voir le système de production
                <span class="iconify" data-icon="mdi:factory"></span>
              </a>
            </div>
          </div>
          <div class="h-1 bg-gradient-to-r from-transparent via-gold-500/70 to-transparent"></div>
        </div>
      </section>

      <!-- Right: summary -->
      <aside class="lg:col-span-4">
        <div class="lg:sticky lg:top-24 space-y-4">
          <div class="rounded-[28px] card-light shadow-lift p-6">
            <div class="flex items-center justify-between">
              <h3 class="font-display text-xl">Récapitulatif</h3>
              <span
                class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-semibold bg-vanilla-100 border border-cacao-900/10">
                <span class="iconify text-gold-600" data-icon="mdi:shield-check-outline"></span>
                Confiance <span class="text-cacao-500">(à confirmer)</span>
              </span>
            </div>

            <div class="mt-5 space-y-3 text-sm">
              <div class="flex items-center justify-between">
                <p class="text-cacao-700">Sous-total</p>
                <p class="font-semibold" id="subtotal">0,00 €</p>
              </div>
              <div class="flex items-center justify-between">
                <p class="text-cacao-700">Livraison</p>
                <p class="text-cacao-700" id="shippingLine">Calculée à l’étape suivante</p>
              </div>
              <div class="flex items-center justify-between">
                <p class="text-cacao-700">Taxes</p>
                <p class="text-cacao-700" id="taxLine">Selon destination</p>
              </div>

              <div class="pt-3 border-t border-cacao-900/10 flex items-center justify-between">
                <p class="text-cacao-900 font-semibold">Total estimé</p>
                <p class="text-xl font-semibold" id="total">0,00 €</p>
              </div>
            </div>

            <!-- CTA checkout -->
            <button id="checkoutBtn"
              class="mt-5 w-full inline-flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-semibold text-jungle-900
                     bg-gradient-to-b from-gold-500 to-gold-600 shadow-glow hover:shadow-lift transition rm-anim focus-ring">
              Passer au paiement
              <span class="iconify" data-icon="mdi:lock-outline"></span>
            </button>
            <p class="mt-2 text-xs text-cacao-600">
              Paiement sécurisé (à connecter) • Vous pourrez confirmer l’adresse et la livraison au checkout.
            </p>

            <!-- Express checkout placeholders -->
            <div class="mt-4 grid grid-cols-2 gap-3">
              <button
                class="inline-flex items-center justify-center gap-2 rounded-full px-4 py-2.5 text-sm font-semibold bg-white/80 border border-cacao-900/10 hover:bg-white focus-ring">
                <span class="iconify text-cacao-700" data-icon="mdi:apple"></span>
                Apple Pay
              </button>
              <button
                class="inline-flex items-center justify-center gap-2 rounded-full px-4 py-2.5 text-sm font-semibold bg-white/80 border border-cacao-900/10 hover:bg-white focus-ring">
                <span class="iconify text-cacao-700" data-icon="mdi:paypal"></span>
                PayPal
              </button>
            </div>
            <p class="mt-2 text-[11px] text-cacao-500">Boutons express = placeholders UI (à brancher si dispo).</p>

            <!-- Coupon (no fake discount) -->
            <details class="mt-5 rounded-xxl bg-white/75 border border-cacao-900/10 p-4">
              <summary class="cursor-pointer text-sm font-semibold focus-ring rounded-xl px-2 py-1">
                Vous avez un code promo ?
              </summary>
              <div class="mt-3 flex gap-2">
                <input id="couponInput" type="text" placeholder="Entrer le code"
                  class="w-full rounded-full px-4 py-2.5 text-sm bg-white border border-cacao-900/10 focus-ring" />
                <button id="applyCouponBtn"
                  class="rounded-full px-4 py-2.5 text-sm font-semibold bg-vanilla-100 border border-cacao-900/10 hover:bg-vanilla-200 focus-ring">
                  Appliquer
                </button>
              </div>
              <p id="couponMsg" class="mt-2 text-xs text-cacao-600"></p>
            </details>

            <!-- Trust row (no promises) -->
            <div class="mt-5 grid grid-cols-3 gap-3 text-xs">
              <div class="rounded-xxl bg-white/70 border border-cacao-900/10 p-3 text-center">
                <span class="iconify text-gold-600 text-xl" data-icon="mdi:truck-outline"></span>
                <p class="mt-1 font-semibold">Livraison</p>
                <p class="text-cacao-500">à préciser</p>
              </div>
              <div class="rounded-xxl bg-white/70 border border-cacao-900/10 p-3 text-center">
                <span class="iconify text-gold-600 text-xl" data-icon="mdi:restore"></span>
                <p class="mt-1 font-semibold">Retours</p>
                <p class="text-cacao-500">à préciser</p>
              </div>
              <div class="rounded-xxl bg-white/70 border border-cacao-900/10 p-3 text-center">
                <span class="iconify text-gold-600 text-xl" data-icon="mdi:chat-outline"></span>
                <p class="mt-1 font-semibold">Support</p>
                <p class="text-cacao-500">contact</p>
              </div>
            </div>

            <div class="mt-5 flex items-center justify-between text-xs text-cacao-500">
              <div class="flex items-center gap-2">
                <span class="iconify" data-icon="mdi:credit-card-outline"></span>
                <span>Paiements</span>
              </div>
              <div class="flex items-center gap-2 text-lg">
                <span class="iconify" data-icon="mdi:visa"></span>
                <span class="iconify" data-icon="mdi:mastercard"></span>
                <span class="iconify" data-icon="mdi:credit-card-outline"></span>
              </div>
            </div>
          </div>

          <!-- Reassurance note -->
          <div class="rounded-[28px] bg-white/70 border border-cacao-900/10 p-5">
            <p class="text-sm font-semibold">Mini check anti-abandon</p>
            <ul class="mt-3 space-y-2 text-sm text-cacao-700">
              <li class="flex gap-2"><span class="iconify text-gold-600 mt-0.5"
                  data-icon="mdi:check-circle-outline"></span> Votre panier est sauvegardé automatiquement.</li>
              <li class="flex gap-2"><span class="iconify text-gold-600 mt-0.5"
                  data-icon="mdi:check-circle-outline"></span> Vous confirmerez la livraison au paiement.</li>
              <li class="flex gap-2"><span class="iconify text-gold-600 mt-0.5"
                  data-icon="mdi:check-circle-outline"></span> Besoin d’aide ? <a
                  class="underline underline-offset-4 font-semibold focus-ring rounded px-1"
                  href="contact.html">Contactez-nous</a>.</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- Mobile sticky CTA (conversion) -->
  <div id="mobileBar"
    class="lg:hidden fixed bottom-0 left-0 right-0 z-40 bg-white/85 backdrop-blur border-t border-cacao-900/10">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-3">
      <div>
        <p class="text-xs text-cacao-600">Total estimé</p>
        <p class="text-base font-semibold" id="mobileTotal">0,00 €</p>
      </div>
      <button id="mobileCheckoutBtn" class="inline-flex items-center justify-center gap-2 rounded-full px-5 py-3 text-sm font-semibold text-jungle-900
               bg-gradient-to-b from-gold-500 to-gold-600 shadow-glow focus-ring">
        Payer
        <span class="iconify" data-icon="mdi:lock-outline"></span>
      </button>
    </div>
  </div>

  <script>
    // =========================
    // CONFIG (conversion)
    // =========================
    // Mets 0 si tu ne veux pas afficher le "seuil" dans le hero.
    const FREE_SHIPPING_THRESHOLD = 0; // ex: 79
    const CHECKOUT_URL = "checkout.html"; // à brancher

    // =========================
    // CART STORAGE (compatible avec tes pages précédentes)
    // =========================
    const CART_KEYS = ["msv_cart", "cart"];
    const fmt = new Intl.NumberFormat("fr-FR", { style: "currency", currency: "EUR" });
    const $ = (id) => document.getElementById(id);

    function safeParse(v, fb) { try { return JSON.parse(v); } catch { return fb; } }
    function resolveCartKey() { for (const k of CART_KEYS) if (localStorage.getItem(k)) return k; return CART_KEYS[0]; }
    const CART_KEY = resolveCartKey();

    function normalize(raw) {
      if (!raw) return [];
      if (Array.isArray(raw)) return raw;
      if (Array.isArray(raw.items)) return raw.items;
      if (Array.isArray(raw.cart)) return raw.cart;
      if (Array.isArray(raw.products)) return raw.products;
      return [];
    }

    function getCart() {
      const raw = safeParse(localStorage.getItem(CART_KEY), null);
      return normalize(raw).map(it => ({
        id: it.id ?? it.sku ?? it.slug ?? String(Math.random()),
        name: it.name ?? it.title ?? "Produit",
        price: Number(it.price ?? it.unitPrice ?? 0),
        qty: Math.max(1, Number(it.qty ?? it.quantity ?? 1)),
        image: it.image ?? it.img ?? it.thumbnail ?? ""
      }));
    }

    function setCart(items) { localStorage.setItem(CART_KEY, JSON.stringify(items)); }
    function cartCount(items) { return items.reduce((s, it) => s + (it.qty || 0), 0); }
    function cartSubtotal(items) { return items.reduce((s, it) => s + (it.price * it.qty), 0); }
    function esc(str) {
      return String(str).replace(/[&<>"']/g, s => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" }[s]));
    }

    // =========================
    // UI refs
    // =========================
    const itemsList = $("itemsList");
    const emptyState = $("emptyState");
    const subtotalEl = $("subtotal");
    const totalEl = $("total");
    const mobileTotalEl = $("mobileTotal");

    const clearCartBtn = $("clearCartBtn");
    const checkoutBtn = $("checkoutBtn");
    const mobileCheckoutBtn = $("mobileCheckoutBtn");

    const couponInput = $("couponInput");
    const applyCouponBtn = $("applyCouponBtn");
    const couponMsg = $("couponMsg");

    // Hero goal
    const goalText = $("goalText");
    const goalBar = $("goalBar");

    // =========================
    // Render cart items (conversion UX)
    // =========================
    function render() {
      const items = getCart();
      const empty = items.length === 0;

      emptyState.classList.toggle("hidden", !empty);
      itemsList.classList.toggle("hidden", empty);
      clearCartBtn.disabled = empty;
      clearCartBtn.classList.toggle("opacity-50", empty);

      // Totals
      const subtotal = cartSubtotal(items);
      // Pas de fausses taxes/livraison : on garde "estimé" = sous-total
      subtotalEl.textContent = fmt.format(subtotal || 0);
      totalEl.textContent = fmt.format(subtotal || 0);
      mobileTotalEl.textContent = fmt.format(subtotal || 0);

      // Hero threshold (optional)
      if (FREE_SHIPPING_THRESHOLD > 0) {
        const pct = Math.max(0, Math.min(100, (subtotal / FREE_SHIPPING_THRESHOLD) * 100));
        goalBar.style.width = pct + "%";
        if (subtotal >= FREE_SHIPPING_THRESHOLD) {
          goalText.textContent = "Seuil atteint (configurable)";
        } else {
          const missing = FREE_SHIPPING_THRESHOLD - subtotal;
          goalText.textContent = "Encore " + fmt.format(missing) + " (configurable)";
        }
      } else {
        goalBar.style.width = "0%";
        goalText.textContent = "Livraison calculée au checkout";
      }

      if (empty) {
        itemsList.innerHTML = "";
        return;
      }

      itemsList.innerHTML = items.map((it, idx) => {
        const lineTotal = (it.price || 0) * (it.qty || 0);
        return `
          <article class="rounded-[28px] card-light shadow-soft p-5">
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
              <div class="flex items-center gap-4 flex-1 min-w-0">
                <div class="w-20 h-20 rounded-2xl bg-white/70 border border-cacao-900/10 overflow-hidden grid place-items-center flex-shrink-0">
                  ${it.image
            ? `<img src="${it.image}" alt="${esc(it.name)}" class="w-full h-full object-cover" onerror="this.remove(); this.parentElement.innerHTML='<span class=&quot;iconify text-gold-600 text-3xl&quot; data-icon=&quot;mdi:vanilla&quot;></span>';">`
            : `<span class="iconify text-gold-600 text-3xl" data-icon="mdi:vanilla"></span>`
          }
                </div>

                <div class="min-w-0">
                  <p class="font-semibold text-cacao-900 truncate">${esc(it.name)}</p>
                  <p class="mt-1 text-sm text-cacao-700">${fmt.format(it.price || 0)} <span class="text-xs text-cacao-500">/ unité</span></p>

                  <!-- micro reassurance -->
                  <div class="mt-2 flex flex-wrap gap-2 text-xs">
                    <span class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 bg-vanilla-100 border border-cacao-900/10">
                      <span class="iconify text-gold-600" data-icon="mdi:check-circle-outline"></span>
                      Sélection premium
                    </span>
                    <span class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 bg-vanilla-100 border border-cacao-900/10">
                      <span class="iconify text-gold-600" data-icon="mdi:archive-outline"></span>
                      Conditionné avec soin
                    </span>
                  </div>
                </div>
              </div>

              <div class="flex items-center justify-between sm:justify-end gap-4">
                <!-- Qty control -->
                <div class="inline-flex items-center rounded-full bg-white/75 border border-cacao-900/10 overflow-hidden">
                  <button class="w-11 h-10 grid place-items-center hover:bg-vanilla-100 focus-ring"
                    data-action="dec" data-index="${idx}" aria-label="Diminuer">
                    <span class="iconify text-cacao-800" data-icon="mdi:minus"></span>
                  </button>
                  <span class="px-4 text-sm font-semibold text-cacao-900">${it.qty}</span>
                  <button class="w-11 h-10 grid place-items-center hover:bg-vanilla-100 focus-ring"
                    data-action="inc" data-index="${idx}" aria-label="Augmenter">
                    <span class="iconify text-cacao-800" data-icon="mdi:plus"></span>
                  </button>
                </div>

                <div class="text-right min-w-[110px]">
                  <p class="text-xs text-cacao-600">Total</p>
                  <p class="text-base font-semibold text-cacao-900">${fmt.format(lineTotal || 0)}</p>
                </div>

                <button class="p-2 rounded-2xl hover:bg-vanilla-100 focus-ring"
                  data-action="remove" data-index="${idx}" aria-label="Supprimer">
                  <span class="iconify text-cacao-700 text-xl" data-icon="mdi:trash-outline"></span>
                </button>
              </div>
            </div>
          </article>
        `;
      }).join("");
    }

    function mutate(mutator) {
      const items = getCart();
      mutator(items);
      const cleaned = items
        .map(it => ({ ...it, qty: Math.max(0, Number(it.qty || 0)) }))
        .filter(it => it.qty > 0);
      setCart(cleaned);
      render();
    }

    // =========================
    // Events
    // =========================
    itemsList.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      const action = btn.getAttribute("data-action");
      const index = Number(btn.getAttribute("data-index"));
      mutate((items) => {
        if (!items[index]) return;
        if (action === "remove") items.splice(index, 1);
        if (action === "inc") items[index].qty += 1;
        if (action === "dec") items[index].qty = Math.max(0, items[index].qty - 1);
      });
    });

    clearCartBtn.addEventListener("click", () => {
      setCart([]);
      render();
    });

    function goCheckout() {
      const items = getCart();
      if (!items.length) return;
      window.location.href = CHECKOUT_URL;
    }

    checkoutBtn.addEventListener("click", goCheckout);
    mobileCheckoutBtn.addEventListener("click", goCheckout);

    applyCouponBtn.addEventListener("click", () => {
      const code = (couponInput.value || "").trim();
      if (!code) {
        couponMsg.textContent = "Entrez un code puis appliquez.";
        return;
      }
      // Pas de fausse réduction : on garde un message neutre.
      couponMsg.textContent = "Code enregistré. (La réduction doit être appliquée côté checkout/paiement.)";
    });

    window.addEventListener("storage", (e) => {
      if (CART_KEYS.includes(e.key)) render();
    });

    // Boot
    render();
  </script>
</body>

</html>